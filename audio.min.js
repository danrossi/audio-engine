function round(e){return Math.round(100*e)/100}function getAudioType(e){return/mpegurl/i.test(e)?"application/x-mpegurl":"audio/"+e}function canPlayAudio(e){return!!AUDIO.canPlayType(TYPES[e]).replace("no","")}!function(){if("function"==typeof $.fn.flowplayer){var e=flowplayer.support,r=$("<audio/>")[0];$.extend(e,{audio:!!r.canPlayType})}}();var AUDIO=$("<audio/>")[0],EVENTS={ended:"finish",pause:"pause",play:"resume",progress:"buffer",timeupdate:"progress",volumechange:"volume",ratechange:"speed",seeking:"beforeseek",seeked:"seek",loadedmetadata:"ready",error:"error",dataunavailable:"error"},TYPES={mp4:'audio/mp4; codecs="mp4a.40.2, mp4a.40.5"',mpeg:'audio/mpeg; codecs="mp3"',ogg:'audio/ogg; codecs="vorbis"',"audio/mp4":'audio/mp4; codecs="mp4a.40.2, mp4a.40.5"',"audio/mpeg":'audio/mpeg; codecs="mp3"',"audio/ogg":'audio/ogg; codecs="vorbis"'},createAudioTag=function(e){return $("<audio/>",{src:e.src,type:getAudioType(e.type),"class":"fp-engine",autoplay:"autoplay",id:Math.random(),preload:"none","x-webkit-airplay":"allow"})};flowplayer.engine.audio=function(e,r){function o(o,a,u){o.listening||(o.listening=!0,e.bind("error",function(){l<i.length&&r.removeClass("is-error")}),u.bind("error",function(o){r.removeClass("is-error"),canPlayAudio($(o.target).attr("type"))&&l>=i.length?e.trigger("error",{code:4}):(r.removeClass("is-error"),l++,t.load(i[l]))}),$.each(EVENTS,function(t,i){o.addEventListener(t,function(u){if("progress"==i&&u.srcElement&&0===u.srcElement.readyState&&setTimeout(function(){e.video.duration||(i="error",e.trigger(i,{code:4}))},1e4),s.debug&&!/progress/.test(i)&&console.log(t,"->",i,u),(e.ready||/ready|error/.test(i))&&i&&$("audio",r).length){var d,c=$.Event(i);switch(i){case"ready":l=0,d=$.extend(a,{duration:o.duration,width:o.videoWidth,height:o.videoHeight,url:o.currentSrc,src:o.currentSrc});try{a.seekable=o.seekable&&o.seekable.end(null)}catch(p){}n=n||setInterval(function(){try{a.buffer=o.buffered.end(null)}catch(r){}a.buffer&&(a.buffer<=a.duration&&!a.buffered?e.trigger("buffer",u):a.buffered||(a.buffered=!0,e.trigger("buffer",u).trigger("buffered",u),clearInterval(n),n=0))},250);break;case"progress":case"seek":if(o.currentTime>0){d=Math.max(o.currentTime,0);break}if("progress"==i)return;case"speed":d=round(o.playbackRate);break;case"volume":d=round(o.volume);break;case"error":d=(u.srcElement||u.originalTarget).error}e.trigger(c,d)}},!1)}))}var a,t,n,i,u,d=flowplayer.support,c=$("track",$("video",r)),s=e.conf,l=0;return $("video",r).remove(),$(".fp-fullscreen",r).remove(),t={pick:function(e){if(d.audio){i=e;for(var r=0;r<e.length;r++)if(canPlayAudio(e[r].type))return e[r]}},load:function(t){if(s.splash&&!u)a=createAudioTag(t).prependTo(r),c.length&&a.append(c.attr("default","")),s.loop&&a.attr("loop","loop"),u=a[0];else{u=a[0];var n=a.find("source");!u.src&&n.length&&(u.src=t.src,n.remove()),e.video.src&&t.src!=e.video.src||l?(a.attr("autoplay","autoplay"),u.src=t.src):"none"!=s.preload&&d.dataload||(d.zeropreload?e.trigger("ready",t).trigger("pause").one("ready",function(){r.trigger("resume",[e])}):e.one("ready",function(){r.trigger("pause",[e])}))}o(u,t,$("source",a).add(a)),"none"==s.preload&&d.zeropreload&&d.dataload||u.load(),s.splash&&u.load()},pause:function(){u.pause()},resume:function(){u.play()},speed:function(e){u.playbackRate=e},seek:function(e){try{u.currentTime=e}catch(r){}},volume:function(e){u.volume=e},unload:function(){$("audio",r).remove(),n=clearInterval(n),u=0}}};